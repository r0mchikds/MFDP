# Multimodal Product Recommender System (Amazon Grocery)

Данный проект реализует прототип рекомендательной системы для товаров из категории **Grocery & Gourmet Food** на Amazon.\
Цель — построить и сравнить несколько моделей рекомендаций: от простых бейзлайнов до мультимодального матчинга с использованием эмбеддингов CLIP и нейросетевой архитектуры.

---
## Используемые датасеты

Проект построен на двух официальных Amazon-датасетах:

### `meta_Grocery_and_Gourmet_Food.json.gz` (метаинформация)
Содержит:
- `asin`, `title`, `description`, `brand`, `category`
- ссылки на изображения товаров
- цена и другие характеристики

Применяется для:
- генерации текстовых и визуальных эмбеддингов (CLIP, TF-IDF)
- формирования признаков для моделей

### `Grocery_and_Gourmet_Food_5.json.gz` (отзывы пользователей)
Содержит:
- `reviewerID`, `asin`, `rating`, `timestamp`
- текст отзыва и краткое summary

Применяется для:
- построения обучающей выборки
- генерации меток `label ∈ {0, 1}` на основе рейтингов или семплирования

Все данные взяты из [Amazon Reviews Dataset](https://nijianmo.github.io/amazon/index.html)

---

## Общий пайплайн

1. **Предобработка карточек товаров (`meta`)**  
   - Очистка и нормализация полей: `title`, `brand`, `category`, `price`, `description`
   - Генерация признаков (`title_len`, `is_top20_brand` и т.д.)
   - Генерация TF-IDF + PCA по `text_full`
   - Генерация эмбеддингов CLIP (ViT-B/32) по тексту и изображению

2. **Обработка отзывов пользователей (`interactions`)**  
   - Очистка, отбор признаков (`user_id`, `item_id`, `rating`, `timestamp`)
   - Фильтрация по активности (`user ≥ 2`, `item ≥ 5`)

3. **Генерация train/test выборок**  
   - `n-pair`: 1 позитив + 1 негатив на пользователя
   - `rating-based`: метка `label=1`, если `rating ≥ 4`, иначе `0`

4. **Обучение моделей**  
   - `Baseline 0`: по популярности
   - `Baseline 1`: CatBoost на TF-IDF признаках
   - `Matching MLP`: мультимодальный нейронный подход

5. **Оценка качества**  
   - Метрики: `Precision@10`, `MAP@10`
   - Оценка по всем товарам и после фильтрации уже просмотренных

---

## Структура и последовательность ноутбуков

| Файл | Назначение |
|------|------------|
| `01_amazon_grocery_preprocessing_and_eda.html` | Обработка карточек товаров (meta), генерация признаков, TF-IDF и CLIP |
| `02_amazon_grocery_interactions_preprocessing_and_eda.html` | Обработка взаимодействий и фильтрация отзывов |
| `03_amazon_dataset_train_test_generation_n_pair.html` | Создание выборок для n-pair подхода |
| `04_model_training_and_evaluation_n_pair.html` | Обучение моделей и оценка метрик (n-pair) |
| `05_amazon_dataset_train_test_generation_rating_based.html` | Создание выборок для rating-based подхода |
| `06_model_training_and_evaluation_rating_based.html` | Обучение моделей и оценка метрик (rating-based) |

---

## `Сравнение моделей (n-pair sampling)`

| Модель                  | Тестовый сценарий   | Precision@10 | MAP@10    |
|------------------------|---------------------|--------------|-----------|
| **Baseline 0**         | по всем товарам     | 0.0034       | 0.0099    |
| **Baseline 1 (TF-IDF)**| по всем товарам     | 0.0027       | 0.0058    |
|                        | filtered seen items | 0.0022       | 0.0054    |
| **Matching MLP (CLIP)**| по всем товарам     | **0.0198**   | **0.1069**|
|                        | filtered seen items | 0.0104       | 0.0478    |

### Выводы:
- **Matching MLP** существенно превосходит бейзлайны, особенно по MAP@10.
- **TF-IDF модель** даёт слабый результат, уступая даже популярности.
- **Фильтрация виденных товаров** снижает метрики, но делает оценку реалистичнее.

---

## `Сравнение моделей (rating-based)`

| Модель                  | Тестовый сценарий   | Precision@10 | MAP@10    |
|------------------------|---------------------|--------------|-----------|
| **Baseline 0**         | по всем товарам     | 0.0035       | 0.0099    |
| **Baseline 1 (TF-IDF)**| по всем товарам     | 0.0001       | 0.0004    |
|                        | filtered seen items | 0.0000       | 0.0000    |
| **Matching MLP (CLIP)**| по всем товарам     | **0.0100**   | **0.0644**|
|                        | filtered seen items | 0.0030       | 0.0131    |

### Выводы:
- **Matching MLP** сохраняет лидерство и в этом сценарии.
- **TF-IDF модель** почти не работает: вероятно, текстовые сигналы слабо коррелируют с рейтингами.
- **Мультимодальность** и CLIP эмбеддинги дают стабильный выигрыш при любой стратегии генерации выборки.

---

## Общий вывод

Мультимодальный подход с CLIP-эмбеддингами (текст + изображение) и матчинговой нейросетью показывает наиболее устойчивые и интерпретируемые результаты на обоих вариантах выборок, что построенной на основе рейтинга, что при создании негативной выборки. TF-IDF и простая популярность дают слабые метрики, но полезны как бейзлайны. Полученный пайплайн легко масштабируется на другие категории товаров.
